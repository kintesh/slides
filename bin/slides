#!/usr/bin/env node
/**
 * Created by kintesh on 08/02/15.
 */

if (!module.parent) {
    process.title = "slides";
    main(process.argv.slice(), function(err, code) {
        if (err) throw err;
        return process.exit(code || 0);
    });
} else {
    module.exports = main;
}

function main(argv) {

    var program = require("commander"),
        slides = require("../"),
        path = require("path"),
        fs = require("fs"),
        fsx = require("fs-extra");

    program
        .version("0.0.0")
        .usage("[options] [source file]")
        .option("-v, --verbose", "Print verbose output on console")
        .parse(process.argv);

    if(argv.length <= 2) {
        return program.help();
    } else {
        var pwd = process.cwd(),
            inFile = path.join(pwd, argv[argv.length-1]),
            outFile = path.join(pwd, "slides_"+argv[argv.length-1]+".html"),
            assetsDir = path.join(path.dirname(__dirname), "assets"),
            source,
            output;

        if (program.verbose) console.log("Reading file from: " + inFile);

        source = fs.readFileSync(inFile, "utf8");

        if(source != undefined) {
            output = slides(source);

            if(output != undefined) {
                fs.writeFileSync(outFile, output, "utf8");
                if (program.verbose) console.log("Slides saved to  : " + outFile);
                fsx.copySync(assetsDir, path.join(pwd, "slides_assets"));
                if (program.verbose) console.log("Assets copied to : " + path.join(pwd, "slides_assets"));
            }
        }
    }
}
